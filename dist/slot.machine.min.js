!function(a){"use strict";a.widget("custom.slotMachine",{options:{numSlotsToShow:3,easeOutSpeed:1e3,minRounds:7,slotDifferenceFactor:5,spinSpeed:200,hasShaders:!0,hasLever:!0},_create:function(){if(this.options.numSlotsToShow%2===0)throw"slotMachine: numSlotsToShow must be an odd number";if(this.numRows=this.element.find(".slot-bars").children().length,this.numColumns=this.element.find(".slot-bar:nth-child(1) .slot-box").length,0===this.numRows||0===this.numColumns)throw"slotMachine: missing slots";this.options.hasShaders&&this._appendShaders(),this.options.hasLever&&this._createLever(),this._adjustStyles(),this._appendExtraSlots()},_adjustStyles:function(){this.element.find(".slot-bar").css("width",100/this.numColumns+"%"),this.element.find(".slot-box").css("height",100/this.options.numSlotsToShow+"%")},_appendShaders:function(){var b=this.element.find(".slot-bars"),c=a('<div class="slot-top-shader"></div>'),d=a('<div class="slot-bottom-shader"></div>'),e=Math.floor(this.options.numSlotsToShow/2),f=100/this.options.numSlotsToShow*e;c.css("height",f+"%"),d.css("height",f+"%"),b.prepend(c),b.append(d)},_createLever:function(){var b=this,c=this.element.find(".slot-main"),d=a('<div class="slot-lever"></div>'),e=a('<div class="slot-lever-track"></div>');c.prepend(d).prepend(e),d.draggable({axis:"y",containment:c,revert:!0,stop:function(a,e){d.css({left:"",top:""}),c.height()-e.position.top<50&&b.spin()}})},_appendExtraSlots:function(){var b=this;this.element.find(".slot-bar").each(function(){for(var c=a(this),d=1;d<=b.options.numSlotsToShow;d=2*d)c.append(c.children().clone());c.css("bottom",0)})},spin:function(){var b=this.element.find(".slot-bar"),c=this;b.each(function(b){var d=a(this),e=d.height()/c.options.numSlotsToShow,f=function(b,g,h,i,j){d.animate({bottom:j||Math.floor(e*c.numRows)},{easing:b||"linear",duration:h||c.options.spinSpeed,complete:function(){if(!(g>i))if(a(this).css("bottom",0),g===i){var b=Math.floor(Math.random()*c.numRows),d=Math.floor(b*e);console.log(d),f("easeOutBounce",g+1,1e3,i,d)}else f(null,g+1,null,i)}})};f(null,0,null,b*c.options.slotDifferenceFactor+c.options.minRounds)})},destroy:function(){console.log("destroyed")}})}(jQuery);