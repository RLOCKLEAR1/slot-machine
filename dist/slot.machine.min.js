!function(a){"use strict";a.widget("custom.slotMachine",{options:{numSlotsToShow:3,easeOutSpeed:1e3,minRounds:7,slotDifferenceFactor:5,spinSpeed:200,hasShaders:!0,leverThreshold:.7},_create:function(){if(this.options.numSlotsToShow%2===0)throw"slotMachine: numSlotsToShow must be an odd number";this.$slotReels=this.element.find(".slot-reels"),this.$slotReel=this.$slotReels.children(),this.numRows=this.$slotReel.length,this.numReels=this.$slotReel.eq(0).children().length,this.options.hasShaders&&this._appendShaders(),this._createLever(),this._appendExtraSlots(),this._makeResponsive()},_appendShaders:function(){var b=Math.floor(this.options.numSlotsToShow/2),c=100/this.options.numSlotsToShow*b;this.$topShader=a('<div class="slot-top-shader"></div>'),this.$bottomShader=a('<div class="slot-bottom-shader"></div>'),this.$topShader.css("height",c+"%"),this.$bottomShader.css("height",c+"%"),this.$slotReels.prepend(this.$topShader).append(this.$bottomShader)},_createLever:function(){var b=this,c=this.element.find(".slot-main");this.$lever=a('<div class="slot-lever"></div>'),this.$leverTrack=a('<div class="slot-lever-track"></div>'),c.prepend(this.$lever).prepend(this.$leverTrack);var d=this.$lever.height();this.$lever.draggable({axis:"y",containment:c,revert:!0,stop:function(a,e){b.$lever.css({left:"",top:""});var f=e.position.top/(c.height()-d);f>=b.options.leverThreshold&&b.spin()}})},_appendExtraSlots:function(){var b=this;this.extraSlots=[],this.$slotReel.each(function(){for(var c,d=a(this),e=1;e<=b.options.numSlotsToShow;e=2*e)c=d.children().clone(),b.extraSlots.push.apply(b.extraSlots,c),d.append(c);d.css("bottom",0)})},_makeResponsive:function(){this.$slotReel.css("width",100/this.numRows+"%");var a=100/this.options.numSlotsToShow+"%";this.element.find(".slot-box").css("height",a)},_getRandomSlot:function(a,b){var c=Math.floor(Math.random()*a.numRows),d=Math.round(c*b);d+=Math.round(b*a.numRows);var e=Math.floor(a.options.numSlotsToShow/2);return d-=Math.round(e*b),{index:c,bottom:d}},_spinAnimation:function(b,c,d,e,f,g,h){var i=f>=g,j=i?b._getRandomSlot(b,d):null;c.animate({bottom:j&&j.bottom||e},{easing:i?"easeOutBounce":"linear",duration:i?b.options.easeOutSpeed:b.options.spinSpeed,complete:function(){i?h.resolve(j.index):(a(this).css("bottom",0),b._spinAnimation(b,c,d,e,f+1,g,h))}})},spin:function(){var b=this;this._trigger(":spin");var c=this.$slotReel.eq(0).height()/b.options.numSlotsToShow,d=Math.floor(c*b.numRows),e=[];this.$slotReel.each(function(f){var g=f*b.options.slotDifferenceFactor+b.options.minRounds,h=a.Deferred();e.push(h),b._spinAnimation(b,a(this),c,d,0,g,h)}),a.when.apply(a,e).done(b._processResults.bind(b))},_processResults:function(){for(var b=1;b<arguments.length;b++)if(arguments[b]!==arguments[0])return void this._trigger(":lose",null,[a.makeArray(arguments)]);this._trigger(":win",null,[arguments[0]])},_destroy:function(){this.options.hasShaders&&(this.$topShader.remove(),this.$bottomShader.remove()),this.$lever.remove(),this.$leverTrack.remove(),a.each(this.extraSlots,function(a,b){b.remove()})}})}(jQuery);