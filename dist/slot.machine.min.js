!function(a){"use strict";a.widget("custom.slotMachine",{options:{numSlotsToShow:3},_create:function(){if(this.options.numSlotsToShow%2===0)throw"slotMachine: numSlotsToShow must be an odd number";if(this.numRows=this.element.find(".slot-bars").children().length,this.numColumns=this.element.find(".slot-bar:nth-child(1) .slot-box").length,0===this.numRows||0===this.numColumns)throw"slotMachine: missing slots";this._adjustStyles(),this._appendShaders(),this._appendExtraSlots(),this._createLever()},_adjustStyles:function(){this.element.find(".slot-bar").css("width",100/this.numColumns+"%"),this.element.find(".slot-box").css("height",100/this.options.numSlotsToShow+"%")},_appendShaders:function(){var b=this.element.find(".slot-bars"),c=a('<div class="slot-top-shader"></div>'),d=a('<div class="slot-bottom-shader"></div>'),e=Math.floor(this.options.numSlotsToShow/2),f=100/this.options.numSlotsToShow*e;c.css("height",f+"%"),d.css("height",f+"%"),b.prepend(c),b.append(d)},_createLever:function(){var b=this,c=this.element.find(".slot-main"),d=a('<div class="slot-lever"></div>'),e=a('<div class="slot-lever-track"></div>');c.prepend(d).prepend(e),d.draggable({axis:"y",containment:c,revert:!0,stop:function(a,e){d.css({left:"",top:""}),c.height()-e.position.top<50&&b.spin()}})},_appendExtraSlots:function(){var b=this;this.element.find(".slot-bar").each(function(){for(var c=1;c<=b.options.numSlotsToShow;c=2*c)a(this).append(a(this).children().clone());a(this).css("bottom",0)})},spin:function(){var b=this.element.find(".slot-bar"),c=this;b.each(function(){var b=a(this),d=function(e,f,g,h,i){b.animate({bottom:i||b.height()},{easing:e||"linear",duration:g||200,complete:function(){f>h||(a(this).css("bottom",0),f===h?d("easeOutBounce",f+1,500,h,Math.floor(Math.random()*c.options.numSlotsToShow)*Math.floor(b.height()/c.options.numSlotsToShow)):d(null,f+1,null,h))}})},e=Math.floor(20*Math.random()+3);d(null,0,null,e)})},destroy:function(){console.log("destroyed")}})}(jQuery);